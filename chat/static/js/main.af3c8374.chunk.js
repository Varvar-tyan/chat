(this.webpackJsonphuegram=this.webpackJsonphuegram||[]).push([[0],{167:function(e,t,n){},168:function(e,t,n){},181:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(41),c=n.n(s),i=(n(167),n(168),n(134)),o=n(239),u=n(227),l=n(241),d=n(236),j={container:{height:"100vh"},burgerIcon:{mr:2},dotsIcon:{ml:2,flexGrow:2,justifyContent:"flex-end"},gridContainer:{height:"98%"}},b=n(21),h=n(13),x=n(254),f=n(255),p=n(248),g=n(128),O=n.n(g),m=n(87),v=n.n(m),y=n(3),C=n(5),S=n(75),w=n(30),k=Object(C.a)("div")((function(e){var t=e.theme;return Object(y.a)({position:"relative",borderRadius:t.shape.borderRadius,backgroundColor:Object(S.a)(t.palette.common.white,.15),"&:hover":{backgroundColor:Object(S.a)(t.palette.common.white,.25)},marginRight:t.spacing(.5),marginLeft:0,width:"100%"},t.breakpoints.up("sm"),{marginLeft:0,width:"auto"})})),I=Object(C.a)("div")((function(e){return{padding:e.theme.spacing(0,.5,0,1.5),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",size:"large"}})),_=Object(C.a)(w.c)((function(e){var t=e.theme;return{color:"inherit","& .MuiInputBase-input":Object(y.a)({padding:t.spacing(.8,.5,.8,.5),paddingLeft:"calc(1em + ".concat(t.spacing(4),")"),transition:t.transitions.create("width"),width:"100%"},t.breakpoints.up("md"),{width:"100%"})}})),M=n(135),E=n(253),U=n(109),T=n.n(U),D=n(110),L=n.n(D),R=n(92),A=n.n(R),P=n(72),q=n.n(P),$=n(225),F=n(226),W=n(232),N=n(20);var B=n(16),J=n.n(B),H=n(23),z=n(17);var G,Y=function(e){return{type:"PROMISE",status:"PENDING",name:e}},K=function(e,t){return{type:"PROMISE",status:"RESOLVED",name:e,payload:t}},V=function(e,t){return{type:"PROMISE",status:"REJECTED",name:e,error:t}},Q=function(e,t){return function(){var n=Object(H.a)(J.a.mark((function n(r){var a;return J.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(Y(e)),n.prev=1,n.next=4,t;case 4:return a=n.sent,r(K(e,a)),n.abrupt("return",a);case 9:n.prev=9,n.t0=n.catch(1),r(V(e,n.t0));case 12:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()},X=function(e){return Q("photo",function(e){var t=new FormData;return t.append("media",e),fetch("http://chat.fs.a-level.com.ua/upload",{method:"POST",headers:localStorage.authToken?{Authorization:"Bearer "+localStorage.authToken}:{},body:t}).then((function(e){return e.json()}))}(e))},Z=(G="http://chat.fs.a-level.com.ua/graphql",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(G,{method:"POST",headers:Object(z.a)({"Content-Type":"application/json"},localStorage.authToken?{Authorization:"Bearer "+localStorage.authToken}:{}),body:JSON.stringify({query:e,variables:t})}).then((function(e){return e.json()})).then((function(e){if("errors"in e)throw new Error(JSON.stringify(e.errors,null,4));return e.data[Object.keys(t)[0]]}))}),ee=function(e,t){return Q("login",Z("\n        query login($login:String, $password: String) \n        {login(login:$login, password:$password)}",{login:e,password:t}))},te=function(e,t){return Q("register",Z("mutation register($login:String, $password:String) {\n        UserUpsert(user:{\n          login:$login, password:$password\n        })\n        {_id login}\n      }",{UserUpsert:"",login:e,password:t}))},ne=function(e){return Q("users",Z("query findUsers($query:String){\n        UserFind(query: $query){\n          _id login nick avatar {\n            _id url\n          }\n        }\n      }",{UserFind:"",query:JSON.stringify([{},{skip:[e]}])}))},re=function(e){return Q("myChats",Z("query findChats($id:String){\n    ChatFind(query: $id){\n      _id createdAt lastModified title members {_id login} owner {_id login} messages {_id createdAt owner {login} text media {_id url}}\n    }\n  }",{ChatFind:"",id:JSON.stringify([{"members._id":e},{sort:[{lastModified:-1}]}])}))},ae=function(e){return Q("chat",Z("query findExactChat($chatId:String){\n    ChatFindOne(query: $chatId){\n      _id createdAt lastModified owner {_id login} title members {\n        _id login\n      } messages {_id owner {_id login } text  createdAt forwarded {_id owner {login}}\n      }\n    }\n  }",{ChatFindOne:"",chatId:JSON.stringify([{_id:e}])}))},se=function(e){return Q("messages",Z("query FindMessages($chatId:String){\n    MessageFind(query: $chatId){\n      _id createdAt owner {_id login} text chat { _id title}\n    }\n  }",{MessageFind:"",chatId:JSON.stringify([{"chat._id":e}])}))},ce=function(e,t){return Q("setAvatar",Z("mutation setAvatar($myId: ID, $avatarId: ID){\n    UserUpsert(user:{_id: $myId, avatar: {_id: $avatarId}}){\n        _id, avatar{\n            _id\n        }\n      }\n    }",{UserUpsert:"",avatarId:e,myId:t}))},ie=function(e){return{type:"SET_CHATS",chats:e}},oe=function(e){return{type:"SET_CHAT",chat:e}},ue=function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(re(e));case 2:(r=t.sent)&&n(ie(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},le=function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(ae(e));case 2:(r=t.sent)&&n(oe(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},de=function(e){return{type:"SET_MESSAGES",messages:e}},je=function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(se(e));case 2:if(!(r=t.sent)){t.next=5;break}return t.abrupt("return",n(de(r)));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},be=n(22),he=function(e){return{type:"SET_USERS",users:e}},xe=function(e){return{type:"SET_MY_PROFILE",myProfile:e}},fe=function(e){return{type:"SET_USERS_SKIP",skip:e}},pe=function(e){return{type:"LOAD_MORE_USERS",users:e}},ge=function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n((a=e,Q("userById",Z("query findUser($query: String){\n    UserFindOne(query: $query){\n      _id createdAt login nick avatar {\n        _id url\n      }\n    }\n  }",{UserFindOne:"",query:JSON.stringify([{_id:a}])}))));case 2:(r=t.sent)&&n(xe(r));case 4:case"end":return t.stop()}var a}),t)})));return function(e){return t.apply(this,arguments)}}()},Oe=function(e){var t=e.split(".");return JSON.parse(atob(t[1]))};var me=function(e){return{type:"LOGIN",jwt:e}},ve=function(e,t){return function(){var n=Object(H.a)(J.a.mark((function n(r){var a;return J.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r(ee(e,t));case 2:(a=n.sent)&&r(me(a));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},ye=n(247),Ce=n(246),Se=n(249),we=n(89),ke=n.n(we),Ie=n(240),_e=n(224),Me=n(250),Ee=n(90),Ue=n.n(Ee),Te=n(59),De=n(228),Le=n(245),Re={usersListContainer:{height:"300px",overflowY:"auto",marginBottom:"-15px","&::-webkit-scrollbar":{width:"0.4em"},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 6px rgba(0,0,0,0.00)",webkitBoxShadow:"inset 0 0 6px rgba(0,0,0,0.00)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(255,255,255,.3)"}}},Ae=n(218),Pe=n(235),qe=n(98);function $e(e){var t,n=0;for(t=0;t<e.length;t+=1)n=e.charCodeAt(t)+((n<<5)-n);var r="#";for(t=0;t<3;t+=1){r+="00".concat((n>>8*t&255).toString(16)).substr(-2)}return r}function Fe(e){return{sx:{bgcolor:$e(e),width:50,height:50,mr:1.5},children:"".concat(e.split(" ")[0][0])}}var We=n(1),Ne=function(e){return Object(We.jsx)(Ae.a,{divider:!0,selected:e.selectedIndex===e._id,onClick:function(){return e.handleListItemClick(e._id)},children:Object(We.jsxs)(Ie.a,{sx:{display:"flex",alignItems:"center"},children:[e.avatar?Object(We.jsx)(Pe.a,{srcSet:"http://chat.fs.a-level.com.ua/"+e.avatar.url,sx:{width:50,height:50,mr:1.5}}):Object(We.jsx)(Pe.a,Object(z.a)({},Fe(e.login))),Object(We.jsx)(Ie.a,{children:Object(We.jsx)(qe.a,{component:"span",gutterBottom:!0,children:e.login})})]})})},Be=n(46),Je=J.a.mark(Ke),He=J.a.mark(Ve),ze=J.a.mark(Qe),Ge=J.a.mark(Xe),Ye=function(e){return new Promise((function(t){return setTimeout((function(){return t(e)}),e)}))};function Ke(e){var t,n;return J.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.text,r.next=3,Object(Be.b)(ie(null));case 3:return r.next=5,Ye(1500);case 5:return r.t0=Z,r.t1=JSON,r.next=9,Object(Be.c)((function(e){return e.auth.payload.sub.id}));case 9:return r.t2=r.sent,r.t3="/".concat(t,"/"),r.t4={"members._id":r.t2,title:r.t3},r.t5={sort:[{lastModified:-1}]},r.t6=[r.t4,r.t5],r.t7=r.t1.stringify.call(r.t1,r.t6),r.t8={ChatFind:"",id:r.t7},r.next=18,(0,r.t0)("query findChats($id:String){\n        ChatFind(query: $id){\n          _id createdAt lastModified title members {_id login} owner {_id login} messages {_id createdAt}\n        }\n      }",r.t8);case 18:return n=r.sent,r.next=21,Object(Be.b)(ie(n));case 21:case"end":return r.stop()}}),Je)}function Ve(){return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Be.d)("SEARCH_CHATS",Ke);case 2:case"end":return e.stop()}}),He)}function Qe(e){var t,n;return J.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.text,r.next=3,Object(Be.b)(he(null));case 3:return r.next=5,Ye(1500);case 5:return r.next=7,Z("query findUsers($query:String){\n      UserFind(query: $query){\n        _id login nick avatar {\n          _id url\n        }\n      }\n    }",{UserFind:"",query:JSON.stringify([{login:"/".concat(t,"/")}])});case 7:return n=r.sent,r.next=10,Object(Be.b)(he(n));case 10:case"end":return r.stop()}}),ze)}function Xe(){return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Be.d)("SEARCH_USERS",Qe);case 2:case"end":return e.stop()}}),Ge)}var Ze=["users","usersSkip","totalUsersCount","setUsers","searchUsers","loadUsers","setTotalUsers"],et=Object(N.b)((function(e){return{users:e.users.users,usersSkip:e.users.usersSkip,totalUsersCount:e.users.totalUsersCount}}),{setUsers:function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(ne(e));case 2:(r=t.sent)&&(n(he(r)),n(fe(r.length)));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},searchUsers:function(e){return{type:"SEARCH_USERS",text:e}},loadUsers:function(e){return function(){var t=Object(H.a)(J.a.mark((function t(n){var r;return J.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(ne(e));case 2:(r=t.sent)&&(n(fe(+e+r.length)),n(pe(r)));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setTotalUsers:function(){return function(){var e=Object(H.a)(J.a.mark((function e(t){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(Q("totalUsersCount",Z('query totalUsersCount{\n    UserCount(query: "[{}]")\n  }',{UserCount:""})));case 2:(n=e.sent)&&t({type:"SET_TOTAL_USERS_COUNT",count:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})((function(e){var t=e.users,n=e.usersSkip,a=e.totalUsersCount,s=e.setUsers,c=e.searchUsers,i=e.loadUsers,o=e.setTotalUsers,u=Object(Te.a)(e,Ze),l=Object(r.useState)(""),d=Object(h.a)(l,2),j=d[0],b=d[1],x=Object(r.useRef)();return Object(r.useEffect)((function(){o(),s(0)}),[]),Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(De.a,{id:"chat-name",label:"Chat Title",variant:"outlined",sx:{mb:2,width:"100%"},value:u.title,onChange:function(e){return u.setTitle(e.target.value)}}),Object(We.jsxs)(k,{sx:{mb:1,mr:0},children:[Object(We.jsx)(I,{children:Object(We.jsx)(v.a,{})}),Object(We.jsx)(_,{placeholder:"Search users\u2026",inputProps:{"aria-label":"search"},value:j,onChange:function(e){b(e.target.value),c(e.target.value)}})]}),Object(We.jsx)(Ie.a,{sx:Re.usersListContainer,onScroll:function(){return function(){if(x.current){var e=x.current,r=e.scrollTop,s=e.scrollHeight;r+e.clientHeight>s-1&&j.length<=0&&(console.log("scrolled to bottom"),t.length<a&&i(n))}}()},ref:x,children:Object(We.jsx)(Le.a,{disablePadding:!0,sx:{mb:0},children:null===t||void 0===t?void 0:t.filter((function(e){return!!e.login})).map((function(e){return Object(We.jsx)(Ne,Object(z.a)({selectedIndex:u.memberId,handleListItemClick:function(e){return u.setMemberId(e)}},e),e._id)}))})})]})})),tt=Object(N.b)((function(e){return{myId:e.auth.payload.sub.id}}),{createNewChat:function(e,t){return Q("newChat",Z("mutation createChat($title: String, $members:[UserInput]){\n        ChatUpsert(chat:{\n          title: $title, members:$members\n        }) {\n          _id createdAt lastModified owner {\n            _id login\n          } members {\n            _id login\n          }\n        }\n      }",{ChatUpsert:"",title:e,members:[{_id:t}]}))},setChats:ue,setChat:le})((function(e){var t=e.onClose,n=e.open,a=Object(r.useState)("my new chat"),s=Object(h.a)(a,2),c=s[0],i=s[1],o=Object(r.useState)(""),u=Object(h.a)(o,2),l=u[0],d=u[1],j=Object(b.f)(),x=function(){t(),i("my new chat"),d("")},f=function(){var n=Object(H.a)(J.a.mark((function n(){var r;return J.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.createNewChat(c,l);case 2:(r=n.sent)._id&&(t(),i("my new chat"),d(""),e.setChats(e.myId),e.setChat(r._id),j.push("/main/dialog/"+r._id));case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(We.jsxs)(Ce.a,{onClose:x,open:n,maxWidth:"xs",fullWidth:!0,children:[Object(We.jsxs)(Ie.a,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(We.jsx)(ye.a,{children:"New Chat"}),Object(We.jsx)(p.a,{sx:{mr:1},onClick:x,children:Object(We.jsx)(ke.a,{})})]}),Object(We.jsx)(_e.a,{}),Object(We.jsx)(Se.a,{children:Object(We.jsx)(et,{title:c,memberId:l,setTitle:i,setMemberId:d})}),Object(We.jsx)(Me.a,{children:Object(We.jsx)(p.a,{onClick:f,disabled:c.length<=0||l.length<=0,children:Object(We.jsx)(Ue.a,{})})})]})})),nt=n(238),rt=n(230),at=n(251),st=n(252),ct=n(231),it=n(127),ot=n.n(it),ut=n(125),lt=n.n(ut),dt=function(e){var t=new Date(+e),n=t.getMonth(),r=t.getDate(),a=t.getHours(),s=t.getMinutes();return(new Date).getDate()===r?"".concat(a.toString().length<2?"0"+a:a,":").concat(s.toString().length<2?"0"+s:s):"".concat(r," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n]," ").concat(a.toString().length<2?"0"+a:a,":").concat(s.toString().length<2?"0"+s:s)},jt=n(136),bt=Object(N.b)((function(e){return{myId:e.auth.payload.sub.id}}),{handleDrop:function(e,t){return function(){var n=Object(H.a)(J.a.mark((function n(r){var a;return J.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r(X(e));case 2:if(!(null===(a=n.sent)||void 0===a?void 0:a._id)){n.next=8;break}return n.next=6,r(ce(a._id,t));case 6:return n.next=8,r(ge(t));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}})((function(e){var t=e.handleDrop,n=e.myId,a=Object(r.useCallback)((function(e){console.log(e),t(e[0],n)}),[]),s=Object(jt.a)({onDrop:a}),c=s.getRootProps,i=s.getInputProps,o=s.isDragActive;return Object(We.jsxs)("div",Object(z.a)(Object(z.a)({},c()),{},{style:{cursor:"pointer"},children:[Object(We.jsx)("input",Object(z.a)({},i())),o?Object(We.jsx)(qe.a,{variant:"body2",children:"Drop the image here ..."}):Object(We.jsx)(qe.a,{variant:"body2",children:"Drag 'n' drop an image here, or click to select an image"})]}))})),ht=Object(N.b)((function(e){return{myProfile:e.users.myProfile,myId:e.auth.payload.sub.id}}),{setMyProfile:ge})((function(e){var t=e.myProfile,n=e.myId,a=e.setMyProfile;return Object(r.useEffect)((function(){a(n)}),[]),console.log(t),Object(We.jsxs)(Ie.a,{children:[Object(We.jsx)(Ie.a,{sx:{height:"250px",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",mb:1},children:(null===t||void 0===t?void 0:t.avatar)?Object(We.jsx)("img",{src:"http://chat.fs.a-level.com.ua/"+t.avatar.url,height:"100%"}):Object(We.jsx)(nt.a,{label:"No avatar",variant:"filled"})}),Object(We.jsx)(Ie.a,{children:Object(We.jsxs)(rt.a,{disableGutters:!0,square:!0,children:[Object(We.jsxs)(at.a,{"aria-controls":"panel1a-content",id:"panel1a-header",sx:{py:0},children:[Object(We.jsx)(lt.a,{fontSize:"large",sx:{mr:2.5}}),Object(We.jsx)(qe.a,{sx:{lineHeight:2.3},children:"Set Avatar"})]}),Object(We.jsx)(st.a,{children:Object(We.jsx)(bt,{})})]})}),Object(We.jsx)(Ie.a,{children:Object(We.jsxs)(Le.a,{sx:{pl:2},children:[Object(We.jsxs)(ct.a,{disablePadding:!0,children:[Object(We.jsx)($.a,{children:Object(We.jsx)(q.a,{fontSize:"large"})}),Object(We.jsxs)(F.a,{children:[Object(We.jsx)(qe.a,{variant:"caption",children:"Login"}),Object(We.jsx)(qe.a,{children:null===t||void 0===t?void 0:t.login})]})]}),Object(We.jsxs)(ct.a,{disablePadding:!0,children:[Object(We.jsx)($.a,{children:Object(We.jsx)(ot.a,{fontSize:"large"})}),Object(We.jsxs)(F.a,{children:[Object(We.jsx)(qe.a,{variant:"caption",children:"Profile created"}),Object(We.jsx)(qe.a,{children:dt(null===t||void 0===t?void 0:t.createdAt)})]})]})]})})]})})),xt=function(e){var t=e.onClose,n=e.open,r=function(){t()};return Object(We.jsxs)(Ce.a,{onClose:r,open:n,maxWidth:"xs",fullWidth:!0,children:[Object(We.jsxs)(Ie.a,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(We.jsx)(ye.a,{children:"My Profile"}),Object(We.jsx)(p.a,{sx:{mr:1},onClick:r,children:Object(We.jsx)(ke.a,{})})]}),Object(We.jsx)(_e.a,{}),Object(We.jsx)(Se.a,{children:Object(We.jsx)(ht,{})}),Object(We.jsx)(Me.a,{children:Object(We.jsx)(p.a,{onClick:function(){t()},children:Object(We.jsx)(Ue.a,{})})})]})},ft=Object(N.b)((function(e){return{isDarkMode:e.mode.isDarkMode}}),{setMode:function(e){return{type:"SET_DARK_MODE",isDarkMode:e}},logout:function(){return function(e){e({type:"LOGOUT"}),e(ie(null)),e(xe(null)),e(oe(null)),e(de(null))}}})((function(e){var t=e.open,n=e.anchorEl,a=e.handleClose,s=e.isDarkMode,c=e.setMode,i=e.logout,o=Object(b.f)();var u=Object(r.useState)(!1),l=Object(h.a)(u,2),d=l[0],j=l[1],x=Object(r.useState)(!1),f=Object(h.a)(x,2),p=f[0],g=f[1];return Object(We.jsxs)(We.Fragment,{children:[Object(We.jsxs)(M.a,{id:"basic-menu",anchorEl:n,open:t,onClose:a,MenuListProps:{"aria-labelledby":"basic-button"},children:[Object(We.jsxs)(E.a,{onClick:function(){a(),j(!0)},children:[Object(We.jsx)($.a,{children:Object(We.jsx)(T.a,{})}),Object(We.jsx)(F.a,{children:"New Chat"})]}),Object(We.jsxs)(E.a,{onClick:function(){a(),g(!0)},children:[Object(We.jsx)($.a,{children:Object(We.jsx)(q.a,{})}),Object(We.jsx)(F.a,{children:"My Profile"})]}),Object(We.jsxs)(E.a,{onClick:function(){return c(!s)},children:[Object(We.jsx)($.a,{children:Object(We.jsx)(L.a,{})}),Object(We.jsx)(F.a,{sx:{mr:1},children:"Dark Mode"}),Object(We.jsx)(W.a,{size:"small",checked:s})]}),Object(We.jsxs)(E.a,{onClick:function(){a(),i(),o.push("/")},children:[Object(We.jsx)($.a,{children:Object(We.jsx)(A.a,{})}),Object(We.jsx)(F.a,{children:"Log Out"})]})]}),Object(We.jsx)(tt,{onClose:function(){j(!1)},open:d}),Object(We.jsx)(xt,{onClose:function(){g(!1)},open:p})]})})),pt=Object(N.b)(null,{searchChats:function(e){return{type:"SEARCH_CHATS",text:e}}})((function(e){var t=e.searchChats,n=Object(r.useState)(null),a=Object(h.a)(n,2),s=a[0],c=a[1],i=Boolean(s),o=Object(r.useState)(""),u=Object(h.a)(o,2),l=u[0],d=u[1];return Object(We.jsx)(x.a,{position:"static",children:Object(We.jsxs)(f.a,{children:[Object(We.jsx)(p.a,{edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:function(e){c(e.currentTarget)},children:Object(We.jsx)(O.a,{})}),Object(We.jsx)(ft,{open:i,anchorEl:s,handleClose:function(){c(null)}}),Object(We.jsxs)(k,{children:[Object(We.jsx)(I,{children:Object(We.jsx)(v.a,{})}),Object(We.jsx)(_,{placeholder:"Search\u2026",inputProps:{"aria-label":"search"},value:l,onChange:function(e){d(e.target.value),t(e.target.value)}})]})]})})})),gt={dialogsListContainer:{maxHeight:"88vh",overflowY:"auto","&::-webkit-scrollbar":{width:"0.3em"},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 6px rgba(0,0,0,0.00)",webkitBoxShadow:"inset 0 0 6px rgba(0,0,0,0.00)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(255,255,255,.1)"}},dialogItemContainer:{display:"flex",width:"100%"},dialogItemInfoContainer:{width:"100%"},dialogItemInfo:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center"},messageWrapper:{maxWidth:"160px",overflow:"hidden"},message:{color:"text.secondary"}},Ot=n(233),mt=n(81),vt=["lastModified"],yt=["chat","setMessages"],Ct=Object(N.b)(null,{setMessages:se})((function(e){var t=e.chat,n=t.lastModified,a=Object(Te.a)(t,vt),s=e.setMessages,c=Object(Te.a)(e,yt),i=Object(r.useState)(""),o=Object(h.a)(i,2),u=o[0],l=o[1];return Object(r.useEffect)(Object(H.a)(J.a.mark((function e(){var t,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(a._id);case 2:n=e.sent,l(null===(t=n[n.length-1])||void 0===t?void 0:t.text);case 4:case"end":return e.stop()}}),e)}))),[n]),Object(We.jsx)(Ae.a,{component:mt.a,to:"/main/dialog/"+a._id,divider:!0,selected:c.selectedIndex===a._id,onClick:function(){return c.handleListItemClick(a._id)},children:Object(We.jsxs)(Ie.a,{sx:gt.dialogItemContainer,children:[Object(We.jsx)(Pe.a,Object(z.a)({},Fe(a.title))),Object(We.jsxs)(Ie.a,{sx:gt.dialogItemInfoContainer,children:[Object(We.jsxs)(Ie.a,{sx:gt.dialogItemInfo,children:[Object(We.jsx)(qe.a,{component:"span",noWrap:!0,gutterBottom:!0,sx:gt.messageWrapper,children:a.title}),Object(We.jsx)(qe.a,{component:"span",variant:"caption",children:dt(n)})]}),Object(We.jsxs)(Ie.a,{sx:gt.dialogItemInfo,children:[Object(We.jsx)(Ie.a,{sx:gt.messageWrapper,children:Object(We.jsx)(qe.a,{variant:"body2",noWrap:!0,sx:gt.message,children:a.messages?u:"No messages here yet..."})}),Object(We.jsx)(Ie.a,{children:Object(We.jsx)(Ot.a,{badgeContent:a.messages&&a.messages.length,color:"primary",sx:{mr:2,mb:.8}})})]})]})]})})})),St=["currentChat"],wt=Object(N.b)((function(e){return{chats:e.chats.chats,myId:e.auth.payload.sub.id,currentChat:e.chats.currentChat}}),{setChats:ue})((function(e){var t,n=e.currentChat,a=Object(Te.a)(e,St),s=Object(b.f)(),c=Object(r.useState)(n?n._id:s.location.pathname.slice(13).length>0?s.location.pathname.slice(13):""),i=Object(h.a)(c,2),o=i[0],u=i[1],l=function(e){u(e)};return Object(r.useEffect)((function(){a.setChats(a.myId)}),[]),Object(r.useEffect)((function(){n&&u(n._id)}),[n]),Object(We.jsx)(Ie.a,{sx:gt.dialogsListContainer,children:Object(We.jsx)(Le.a,{disablePadding:!0,children:null===(t=a.chats)||void 0===t?void 0:t.map((function(e){return Object(We.jsx)(Ct,{selectedIndex:o,handleListItemClick:l,chat:e},e._id)}))})})})),kt=function(){return Object(We.jsxs)(d.a,{item:!0,xs:12,md:3.5,children:[Object(We.jsx)(pt,{}),Object(We.jsx)(wt,{})]})},It=n(129),_t=n.n(It),Mt=function(e){var t=e.currentChat;return console.log(t),Object(We.jsx)(Ie.a,{sx:{display:"flex",alignItems:"center"},children:Object(We.jsxs)(Ie.a,{children:[Object(We.jsx)(qe.a,{children:t&&t.title}),Object(We.jsxs)(qe.a,{variant:"caption",gutterBottom:!0,children:["members: ",t&&t.members.length]})]})})},Et=function(e){var t=e.open,n=e.anchorEl,r=e.handleClose;return Object(We.jsx)(We.Fragment,{children:Object(We.jsx)(M.a,{id:"basic-menu",anchorEl:n,open:t,onClose:r,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(We.jsxs)(E.a,{onClick:function(){r()},children:[Object(We.jsx)($.a,{children:Object(We.jsx)(A.a,{})}),Object(We.jsx)(F.a,{children:"Log Out"})]})})})},Ut=function(e){var t=e.currentChat,n=Object(r.useState)(null),a=Object(h.a)(n,2),s=a[0],c=a[1],i=Boolean(s);return Object(We.jsx)(x.a,{position:"static",children:Object(We.jsx)(f.a,{children:Object(We.jsxs)(Ie.a,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(We.jsx)(Mt,{currentChat:t}),Object(We.jsx)(p.a,{edge:"start",color:"inherit","aria-label":"menu",sx:{ml:2},onClick:function(e){c(e.currentTarget)},children:Object(We.jsx)(_t.a,{})}),Object(We.jsx)(Et,{open:i,anchorEl:s,handleClose:function(){c(null)}})]})})})},Tt=n(131),Dt=n.n(Tt),Lt=n(130),Rt=n.n(Lt),At={messageWindowMessagesContainer:{flexGrow:2,height:"500px",overflowY:"auto",display:"flex",flexDirection:"column-reverse",backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat","&::-webkit-scrollbar":{width:"0.4em"},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 6px rgba(0,0,0,0.00)",webkitBoxShadow:"inset 0 0 6px rgba(0,0,0,0.00)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(255,255,255,.3)"}},messageYou:{justifyContent:"flex-end",py:.5},messageCompanion:{justifyContent:"flex-start",py:.5},messageBubbleYou:{maxWidth:"60%",px:1.3,py:1,pb:.3,bgcolor:"background.messageColor",borderTopLeftRadius:13,borderTopRightRadius:13,borderBottomLeftRadius:13,display:"flex",flexDirection:"column"},messageBubbleCompanion:{maxWidth:"60%",px:1.3,py:1,pb:.3,bgcolor:"background.messageDark",borderTopLeftRadius:13,borderTopRightRadius:13,borderBottomRightRadius:13,display:"flex",flexDirection:"column"},dateCaption:{fontSize:"11px",fontWeight:"light",alignSelf:"flex-end"},messageInputCont:{display:"flex",pt:2},sendIcon:{ml:2,mr:2},attachIcon:{ml:2},messageInput:{ml:1}},Pt=n.p+"static/media/back_satan.22933c5e.jpg",qt=n.p+"static/media/back_dooml.539326cb.jpg",$t=function(e){var t=e.message,n=e.myId;return Object(We.jsx)(ct.a,{sx:n===t.owner._id?At.messageYou:At.messageCompanion,children:Object(We.jsxs)(Ie.a,{sx:n===t.owner._id?At.messageBubbleYou:At.messageBubbleCompanion,children:[Object(We.jsx)(qe.a,{variant:"body2",children:t.text}),Object(We.jsx)(qe.a,{component:"span",sx:At.dateCaption,children:dt(t.createdAt)})]})})},Ft=Object(N.b)((function(e){return{isDarkMode:e.mode.isDarkMode}}),{addMessage:function(e,t){return Q("newMessage",Z("mutation addMessage($text: String, $chatId: ID){\n    MessageUpsert(message:{\n      text: $text, chat: {_id: $chatId}\n    }){\n      _id chat {_id title} text\n    }\n  }",{MessageUpsert:"",text:e,chatId:t}))},setMessages:je,setChats:ue})((function(e){var t=e.isDarkMode,n=e.myId,a=e.messages,s=e.setMessages,c=e.addMessage,i=e.chatId,o=e.setChats,u=Object(r.useState)(""),l=Object(h.a)(u,2),d=l[0],j=l[1],b=function(){var e=Object(H.a)(J.a.mark((function e(){var t;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(d.length>0&&d)){e.next=5;break}return e.next=3,c(d,i);case 3:(null===(t=e.sent)||void 0===t?void 0:t._id)&&(s(i),j(""),o(n));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(Ie.a,{sx:Object(z.a)(Object(z.a)({},At.messageWindowMessagesContainer),{},{backgroundImage:"url(".concat(t?Pt:qt,")")}),children:Object(We.jsx)(Le.a,{children:(null===a||void 0===a?void 0:a.length)>0?a.map((function(e){return Object(We.jsx)($t,{message:e,myId:n},e._id)})):Object(We.jsx)("div",{style:{textAlign:"center",marginBottom:"10px"},children:Object(We.jsx)(nt.a,{label:"No messages here :(",variant:"filled",sx:{color:"#fff"}})})})}),Object(We.jsxs)(Ie.a,{sx:At.messageInputCont,children:[Object(We.jsx)(p.a,{edge:"start",color:"inherit","aria-label":"menu",sx:At.attachIcon,children:Object(We.jsx)(Rt.a,{})}),Object(We.jsx)(De.a,{value:d,onChange:function(e){return j(e.target.value)},id:"standard-textarea",placeholder:"Write your message...",multiline:!0,variant:"standard",maxRows:6,fullWidth:!0,sx:At.messageInput}),Object(We.jsx)(p.a,{onClick:b,edge:"start",color:"inherit","aria-label":"menu",sx:At.sendIcon,children:Object(We.jsx)(Dt.a,{})})]})]})})),Wt=Object(N.b)((function(e){return{myId:e.auth.payload.sub.id,currentChat:e.chats.currentChat,messages:e.messages.messages}}),{setChat:le,setMessages:je})((function(e){var t=e.match.params.id,n=e.setChat,a=e.myId,s=e.currentChat,c=e.setMessages,i=e.messages;return Object(r.useEffect)((function(){n(t),c(t)}),[t]),Object(We.jsxs)(d.a,{item:!0,xs:12,md:8.5,sx:{display:"flex",flexDirection:"column"},children:[Object(We.jsx)(Ut,{currentChat:s}),Object(We.jsx)(Ft,{myId:a,messages:i,chatId:t})]})})),Nt={placeholderContainer:{height:"102%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},Bt=Object(N.b)((function(e){return{isDarkMode:e.mode.isDarkMode}}),null)((function(e){var t=e.isDarkMode;return Object(We.jsx)(d.a,{item:!0,xs:12,md:8.5,children:Object(We.jsx)(Ie.a,{sx:Object(z.a)(Object(z.a)({},Nt.placeholderContainer),{},{backgroundImage:"url(".concat(t?Pt:qt,")")}),children:Object(We.jsx)(nt.a,{label:"Select a chat to start messaging...",variant:"filled",sx:{color:"#fff"}})})})})),Jt=Object(i.a)({palette:{mode:"dark",background:{messageDark:"#272727",messageColor:"#2e72c6"}}}),Ht=Object(i.a)({palette:{mode:"light",background:{messageDark:"#fff",messageColor:"#bddeff"}}}),zt=Object(N.b)((function(e){return{isDarkMode:e.mode.isDarkMode}}),null)((function(e){var t=e.isDarkMode;return Object(We.jsxs)(o.a,{theme:t?Jt:Ht,children:[Object(We.jsx)(u.a,{}),Object(We.jsx)(l.a,{disableGutters:!0,sx:j.container,children:Object(We.jsxs)(d.a,{sx:j.gridContainer,container:!0,children:[Object(We.jsx)(kt,{}),Object(We.jsx)(b.b,{path:"/main",exact:!0,component:Bt}),Object(We.jsx)(b.b,{path:"/main/dialog/:id",component:Wt})]})})]})})),Gt=n(133),Yt=n.n(Gt),Kt=n(242),Vt=n(243),Qt=n(93),Xt=n.n(Qt),Zt=Object(N.b)(null,{onLogin:ve})((function(e){var t=e.onLogin,n=Object(r.useState)(""),a=Object(h.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(""),o=Object(h.a)(i,2),u=o[0],j=o[1];return Object(We.jsx)(l.a,{component:"main",maxWidth:"xs",children:Object(We.jsxs)(Ie.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(We.jsx)(Pe.a,{sx:{m:1,bgcolor:"secondary.main"},children:Object(We.jsx)(Xt.a,{})}),Object(We.jsx)(qe.a,{component:"h1",variant:"h5",children:"Log in"}),Object(We.jsxs)(Ie.a,{component:"form",onSubmit:function(e){return e.preventDefault()},sx:{mt:1},children:[Object(We.jsx)(De.a,{margin:"normal",required:!0,fullWidth:!0,id:"login",label:"Login",name:"login",autoComplete:"login",autoFocus:!0,value:s,onChange:function(e){return c(e.target.value)}}),Object(We.jsx)(De.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:u,onChange:function(e){return j(e.target.value)}}),Object(We.jsx)(Kt.a,{fullWidth:!0,type:"submit",variant:"contained",sx:{mt:3,mb:2},onClick:function(){return t(s,u)},children:"Log In"}),Object(We.jsx)(d.a,{container:!0,children:Object(We.jsx)(d.a,{item:!0,xs:!0,children:Object(We.jsx)(Vt.a,{href:"/signup",variant:"body2",children:"Don't have an account? Sign Up"})})})]})]})})})),en=Object(N.b)(null,{onSignUp:function(e,t){return function(){var n=Object(H.a)(J.a.mark((function n(r){return J.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r(te(e,t));case 2:n.sent&&r(ve(e,t));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}})((function(e){var t=e.onSignUp,n=Object(r.useState)(""),a=Object(h.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(""),o=Object(h.a)(i,2),u=o[0],j=o[1],b=Object(r.useState)(""),x=Object(h.a)(b,2),f=x[0],p=x[1];return Object(We.jsx)(l.a,{component:"main",maxWidth:"xs",children:Object(We.jsxs)(Ie.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(We.jsx)(Pe.a,{sx:{m:1,bgcolor:"secondary.main"},children:Object(We.jsx)(Xt.a,{})}),Object(We.jsx)(qe.a,{component:"h1",variant:"h5",children:"Sign up"}),Object(We.jsxs)(Ie.a,{component:"form",onSubmit:function(e){return e.preventDefault()},sx:{mt:3},children:[Object(We.jsxs)(d.a,{container:!0,spacing:2,children:[Object(We.jsx)(d.a,{item:!0,xs:12,children:Object(We.jsx)(De.a,{required:!0,fullWidth:!0,id:"login",label:"Login",name:"login",autoFocus:!0,value:s,onChange:function(e){return c(e.target.value)}})}),Object(We.jsx)(d.a,{item:!0,xs:12,children:Object(We.jsx)(De.a,{required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",value:u,onChange:function(e){return j(e.target.value)}})}),Object(We.jsx)(d.a,{item:!0,xs:12,children:Object(We.jsx)(De.a,{required:!0,fullWidth:!0,name:"passwordVerify",label:"Verify Password",type:"password",id:"passwordVerify",helperText:"Passwords must match.",value:f,onChange:function(e){return p(e.target.value)}})})]}),Object(We.jsx)(Kt.a,{type:"submit",disabled:u!==f,fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:function(){return t(s,u)},children:"Sign Up"}),Object(We.jsx)(d.a,{container:!0,justifyContent:"flex-end",children:Object(We.jsx)(d.a,{item:!0,children:Object(We.jsx)(Vt.a,{href:"/",variant:"body2",children:"Already have an account? Log in"})})})]})]})})})),tn=n(68),nn=n(132),rn=n(137),an=J.a.mark(ln),sn=Object(tn.b)({promise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"PROMISE"===t.type?Object(z.a)(Object(z.a)({},e),{},Object(y.a)({},t.name,{status:t.status,payload:t.payload,error:t.error})):e},auth:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===e?localStorage.authToken?(t.jwt=localStorage.authToken,{token:t.jwt,payload:Oe(t.jwt),isLoggedIn:!0}):{}:"LOGIN"===t.type?(console.log("\u041b\u041e\u0413\u0418\u041d"),localStorage.authToken=t.jwt,{token:t.jwt,payload:Oe(t.jwt),isLoggedIn:!0}):"LOGOUT"===t.type?(console.log("\u041b\u041e\u0413\u0410\u0423\u0422"),delete localStorage.authToken,{isLoggedIn:!1}):e},mode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===e?localStorage.mode?(t.isDarkMode="dark"===localStorage.mode,{isDarkMode:t.isDarkMode}):{isDarkMode:!1}:"SET_DARK_MODE"===t.type?(localStorage.mode=t.isDarkMode?"dark":"light",{isDarkMode:t.isDarkMode}):e},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{usersSkip:0},t=arguments.length>1?arguments[1]:void 0;return"SET_USERS"===t.type?Object(z.a)(Object(z.a)({},e),{},{users:t.users}):"LOAD_MORE_USERS"===t.type?Object(z.a)(Object(z.a)({},e),{},{users:[].concat(Object(be.a)(e.users),Object(be.a)(t.users))}):"SET_MY_PROFILE"===t.type?Object(z.a)(Object(z.a)({},e),{},{myProfile:t.myProfile}):"SET_USERS_SKIP"===t.type?Object(z.a)(Object(z.a)({},e),{},{usersSkip:t.skip}):"SET_TOTAL_USERS_COUNT"===t.type?Object(z.a)(Object(z.a)({},e),{},{totalUsersCount:t.count}):e},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"SET_CHATS"===t.type?Object(z.a)(Object(z.a)({},e),{},{chats:t.chats}):"SET_CHAT"===t.type?Object(z.a)(Object(z.a)({},e),{},{currentChat:t.chat}):e},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"SET_MESSAGES"===t.type?Object(z.a)(Object(z.a)({},e),{},{messages:t.messages}):e}}),cn=Object(rn.a)(),on=[nn.a,cn],un=Object(tn.d)(sn,tn.a.apply(void 0,on));function ln(){return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Be.a)([Ve(),Xe()]);case 2:case"end":return e.stop()}}),an)}un.subscribe((function(){return console.log(un.getState())})),cn.run(ln);var dn=Object(N.b)((function(e){return{isLoggedIn:e.auth.isLoggedIn}}),null)((function(e){var t=e.isLoggedIn;return Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(u.a,{}),t&&Object(We.jsx)(b.b,{exact:!0,path:"/",render:function(){return Object(We.jsx)(b.a,{to:"/main"})}}),Object(We.jsx)(b.b,{path:"/main",component:zt}),Object(We.jsx)(b.b,{path:"/",exact:!0,component:Zt}),Object(We.jsx)(b.b,{path:"/signup",component:en})]})}));var jn=function(){return Object(We.jsx)(N.a,{store:un,children:Object(We.jsx)(b.c,{history:Yt()(),children:Object(We.jsx)(dn,{})})})};c.a.render(Object(We.jsx)(a.a.StrictMode,{children:Object(We.jsx)(jn,{})}),document.getElementById("root"))}},[[181,1,2]]]);
//# sourceMappingURL=main.af3c8374.chunk.js.map